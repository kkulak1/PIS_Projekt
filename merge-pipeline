pipeline {
    agent any

    tools {
        jdk 'jdk-17'
        maven "M3"
        git "Default"
    }

    triggers {
        githubPullRequest(
            autoCloseFailedPullRequests: true,
            autoMergePassedPullRequests: true,
            branches: [[compareType: 'STRICT', pattern: 'main']],
            events: [PULL_REQUEST_MERGED],
            triggerPhrase: ''
        )
    }

    stages {
        stage('Deploying') {
            steps {
                sh "mvn deploy"
            }
        }
    }

    post {
        success {
            githubNotify(
                status: 'SUCCESS',
                account: "kkulak1",
                credentialsId: "github",
                context: 'merge pipeline',
                description: 'Build succeeded',
                repo: "PIS_projekt",
                sha: env.GIT_COMMIT
            )
        }
        failure {
            githubNotify(
                status: 'FAILURE',
                account: "kkulak1",
                credentialsId: "github",
                context: 'merge pipeline',
                description: 'Build failed',
                repo: "PIS_projekt",
                sha: env.GIT_COMMIT
            )
        }
    }
}

